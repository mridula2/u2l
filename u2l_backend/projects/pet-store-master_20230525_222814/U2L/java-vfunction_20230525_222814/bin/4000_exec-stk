#!/bin/sh
#
# $Header: /data/cvsrepo/assess-tools/bin/4000_exec-stk,v 1.1 2013/07/03 07:31:07 miya Exp $
# $Name: rev_1_10 $
#
# ツール名 : 4000_exec-stk
# 概要     : STK ツールの scansummary, scandetail を実行し指定したディレクトリに結果ファイルを書き出す
# 実行方法 : 4000_exec-stk <STKツール名> <対象ファイルリスト> <ソースディレクトリ>
# 入力     : <STKツール名>   : STKツール名 (STK/STKS/STKHL/STKSL)
#          : <対象ファイルリスト> : STKツールの対象ファイルリスト
#          : <ソースディレクトリ> : <対象ファイルリスト> で存在するディレクトリ名
# 出力     : $PJHOME/log/$APNAME/stk/YYYY-MMDD 上に以下のファイルを作成する
#	   : 	stk-YYYY-MMDD_summary.txt : scansummary コマンド出力結果
#	   :    stk-YYYY-MMDD_summary.log : scansummary コマンドログファイル
#	   : 	stk-YYYY-MMDD_detail.txt : scansummary コマンド出力結果
#	   :    stk-YYYY-MMDD_detail.log : scansummary コマンドログファイル
#	   : 	allfunc-YYYY-MMDD_summary.txt : alfucscansummary コマンド出力結果
#	   :    allfunc-YYYY-MMDD_summary.log : alfucscansummary コマンドログファイル
#	   : 	allfunc-YYYY-MMDD_detail.txt : alfucscansummary コマンド出力結果
#	   :    allfunc-YYYY-MMDD_detail.log : alfucscansummary コマンドログファイル

# LANG環境変数の設定
if [ `uname` = "HP-UX" ];
then
	export LANG=C
	export ALLF=STKHL
else
	export LANG=en_US
	export ALLF=STKSL
fi

# 今日の年月日の取得 
DATE=$(date '+%Y-%m%d')

# ログディレクトリ
LOGDIR="$PJHOME/log/$APNAME/stk/$DATE"

# 引数チェック
if [ $# -ne 3 ];
then
	echo "Usage : $0 <STKtool_name> <filelist> <source_dir>"
	echo "	<STKtool_name> : STK|STKS|STKHL|STKSL"
	exit 1
fi

if [ -d "/opt/$1" ];
then
	STK=$1
else
	echo "Not found \"$1\" tool."
	exit 1
fi		

if [ -f $2 ];
then
	FILES=$2
else
	echo "Not found $2."
	exit 1
fi

if [ -d $3 ];
then
	DIR=$3
else
	echo "Not found $3."
	exit 1
fi

if [ ! -d $LOGDIR ];
then
	mkdir -p $LOGDIR
fi

# scansummary の実行
/opt/$STK/bin/scansummary -o text -v -p $LOGDIR/stk-$DATE -f $FILES 2>&1 |
			tee $LOGDIR/stk-$DATE-summary.log

# scandetail の実行
/opt/$STK/bin/scandetail -o text -v -p $LOGDIR/stk-$DATE -f $FILES 2>&1 |
			tee $LOGDIR/stk-$DATE-detail.log

# allfuncsummary の実行
/opt/$ALLF/bin/allfuncsummary -o text -v -p $LOGDIR/allfunc-$DATE -f $FILES 2>&1 |
			tee $LOGDIR/allfunc-$DATE-summary.log

# allfuncdetail の実行
/opt/$ALLF/bin/allfuncdetail -o text -v -p $LOGDIR/allfunc-$DATE -f $FILES 2>&1 |
			tee $LOGDIR/allfunc-$DATE-detail.log

