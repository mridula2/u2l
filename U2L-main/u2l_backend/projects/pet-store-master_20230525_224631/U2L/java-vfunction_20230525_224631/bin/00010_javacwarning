
#
# $Header: /bin/00010_javacwarning,v 1.0 2018/05/10 Bhavna Harinkhede Exp $
# $Name: rev_1_00 $
#
# Tool name: 00010_javacwarning
# Summary  : Script to collect Java Compiler Warnings/Errors 

#Output:$PJHOME/log/$APNAME/java/javacLog/$today/javacWarningError.report
# Execution Method : 00010_javacwarning Dir
# Input    : Dir: $PJHOME/work/$APNAME/new
# Output : File containing Java Compiler Warnings/Errors

today=`date '+%Y-%m%d'`
if [ $# -lt 1 ]
then
echo "usage: 00010_javacwarning <Source_Dir>"
exit 1
fi

while [ $# -ge 1 ]
do
        case "$1" in
        -v | -verbose )
                DEBUG=1
                ;;
        * )
                if [ -d $1 ];
                then
                        DEST=$1
                else
                        echo "ERROR: Not found $1"
                        echo "Usage : $0 Source_dir"
                        exit 1
                fi
        ;;
        esac
        shift;
done

mkdir -p $PJHOME/log/$APNAME/java/javacLog/$today
#ls -R $DEST/*.java > $PJHOME/log/$APNAME/java/javacLog/$today/javalist.out
find . -name "*.java" > $PJHOME/log/$APNAME/java/javacLog/$today/javalist.out
filelist=$PJHOME/log/$APNAME/java/javacLog/$today/javalist.out
#javac -cp .:`find $PJHOME/ -name "*.jar"| tr "\n" ":"`.:`find $PJHOME/ -name "*.class"| tr "\n" ":"` -Xlint:all `cat $filelist` 2>  $PJHOME/log/$APNAME/java/javacLog/$today/javacIssue.log
 javac -Xlint:all -Xlint:cast -Xlint:deprecation -Xlint:divzero -Xlint:empty -Xlint:unchecked -Xlint:fallthrough -Xlint:path -Xlint:serial -Xlint:finally -Xlint:overrides  -Xlint:varargs -Xlint:dep-ann -Xlint:classfile -Xlint:options -Xlint:try -Xlint:static -Xlint:rawtypes  -Xlint:processing -cp .:`find $PJHOME/ -name "*.jar"| tr "\n" ":"`.:`find $PJHOME/ -name "*.class"| tr "\n" ":"`  `cat $filelist` 2>  $PJHOME/log/$APNAME/java/javacLog/$today/javacIssue.log
grep "\.\/"  $PJHOME/log/$APNAME/java/javacLog/$today/javacIssue.log  > $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningErrorList.log

 awk -F: '{print $4 "\t"  $1 "\t" $2 "\t" $3}' $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningErrorList.log > $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningError.report
awk -F"\t" '{n = split($2, a, "/"); ;basename=a[n];dirname = gensub("/?[^/]*/?$", "", "", $2);print (dirname == "" ? (substr($0, 1, 1) == "/" ? "/" : ".") : $1"\t" dirname"\t" basename "\t"  $3 "\t" $4)}' $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningError.report > $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningErrortemp.report
mv $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningErrortemp.report $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningError.report
grep "error" $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningError.report | sed 's/error//g' > $PJHOME/log/$APNAME/java/javacLog/$today/javacErrors.list
grep "warning" $PJHOME/log/$APNAME/java/javacLog/$today/javacWarningError.report | sed 's/warning//g'> $PJHOME/log/$APNAME/java/javacLog/$today/javacWarnings.list 
echo "Java Compilations warnings and errors are in "  $PJHOME/log/$APNAME/java/javacLog/$today/javacIssue.log
echo " Java Compilation Warning list is in " $PJHOME/log/$APNAME/java/javacLog/$today/javacWarnings.list
echo " Java Compilation Errors list is in" $PJHOME/log/$APNAME/java/javacLog/$today/javacErrors.list 
