#!/bin/sh
#
# $Header: /data/cvsrepo/assess-tools/bin/0051_tooliconv,v 1.5 2014/08/01 08:31:36 hmizuno Exp $
# $Name: rev_1_10 $
#
# Tool Name   : 0051_tooliconv
# Description : Code conversion for execution environment
# Syntax      : 0051_tooliconv <src> <dst>
# Input       : <src> : Directory for original tools
#             : <dst> : Directory for after conversion
# Output      : None

if [ $# -ne 2 ];
then
	echo "Usage $0 <src> <dst>"
	exit 1
else
	src=$1
	dst=$2
fi

if [ ! -d $src ];
then
	echo "Not found $src"
	exit 1
fi

if [ ! -d $dst ];
then
	echo "Not found $dst"
	exit 1
fi

FLIST=`find $src -type f -a -not \( -name \*.jar -o -name 0005_comment-erase \)`

if [ "${LANG}" != "ja_JP.utf8" ] && [ "${LANG}" != "ja_JP.UTF8" ];
then 
	to=`echo $LANG | sed -e 's/ja_JP.SJIS/sjis/' -e 's/ja_JP.eucJP/eucJP/'`
	for i in $FLIST
	do
		echo $i
		fname=`basename $i`
		iconv -f utf8 -t $to $i > $i.$$
		if [ $? -eq 0 ];
		then
			mv $i.$$ $dst/$fname
			chmod 775 $dst/$fname
		else
			echo "iconv error : $i"
			rm -f $i.$$
		fi
	done
else
	for i in $FLIST
	do
		echo $i
		fname=`basename $i`
		cp -p $i $dst/$fname
		chmod 775 $dst/$fname
  done
fi

# copy binary file
cp $src/stepcounter.jar $dst
cc -o $dst/0005_comment-erase $src/../src/comment-erase.c
